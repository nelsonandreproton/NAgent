"""
Translation Service
Provides multilingual support for Agent Orchestrator summaries and notifications.
"""

from typing import Dict, Any
import logging


class TranslationService:
    """Service for handling translations and localization"""
    
    def __init__(self, language: str = "pt-pt"):
        self.language = language.lower()
        self.logger = logging.getLogger(__name__)
        
        # Load translations
        self.translations = self._load_translations()
        
        # Validate language
        if self.language not in self.translations:
            self.logger.warning(f"Language '{language}' not supported, falling back to pt-pt")
            self.language = "pt-pt"
    
    def _load_translations(self) -> Dict[str, Dict[str, str]]:
        """Load all translations"""
        return {
            "pt-pt": {
                # Headers and titles
                "daily_summary_title": "ü§ñ Resumo Di√°rio - Agent Orchestrator",
                "email_summary_title": "üìß Resumo de Emails",
                "calendar_summary_title": "üìÖ Resumo do Calend√°rio",
                "unified_summary_title": "üìã Resumo do Dia",
                "system_status_title": "üîç Estado do Sistema",
                "error_notification_title": "‚ùå Agent Orchestrator - Erro",
                
                # Email statistics
                "unread_emails": "Emails n√£o lidos",
                "recent_emails": "Recentes (3h)",
                "no_emails": "Nenhum email n√£o lido encontrado.",
                
                # Calendar statistics  
                "meetings_today": "Reuni√µes hoje",
                "virtual_meetings": "Virtuais",
                "total_duration": "Dura√ß√£o total",
                "no_meetings": "Nenhuma reuni√£o agendada para hoje.",
                
                # Time and date
                "generated_at": "Gerado √†s",
                "on_date": "em",
                "hours": "h",
                "minutes": "m",
                
                # System status
                "available": "Dispon√≠vel",
                "unavailable": "Indispon√≠vel", 
                "connected": "Ligado",
                "disconnected": "Desligado",
                "accessible": "Acess√≠vel",
                "not_accessible": "N√£o Acess√≠vel",
                "authenticated": "Autenticado",
                "not_authenticated": "N√£o Autenticado",
                
                # Notifications
                "scheduled_run_started": "Execu√ß√£o Agendada",
                "scheduled_run_started_msg": "A iniciar gera√ß√£o autom√°tica do resumo di√°rio...",
                "scheduled_run_completed": "Resumo Conclu√≠do",
                "scheduled_run_completed_msg": "Gera√ß√£o autom√°tica do resumo di√°rio foi conclu√≠da com sucesso!",
                "test_connection": "Agent Orchestrator - Teste de liga√ß√£o",
                
                # Errors and warnings
                "warnings": "Avisos",
                "errors": "Erros",
                "connection_test": "Verifica√ß√£o",
                
                # Days of week
                "monday": "Segunda-feira",
                "tuesday": "Ter√ßa-feira", 
                "wednesday": "Quarta-feira",
                "thursday": "Quinta-feira",
                "friday": "Sexta-feira",
                "saturday": "S√°bado",
                "sunday": "Domingo"
            },
            
            "pt-br": {
                # Headers and titles
                "daily_summary_title": "ü§ñ Resumo Di√°rio - Agent Orchestrator",
                "email_summary_title": "üìß Resumo de E-mails",
                "calendar_summary_title": "üìÖ Resumo do Calend√°rio",
                "unified_summary_title": "üìã Resumo do Dia",
                "system_status_title": "üîç Status do Sistema",
                "error_notification_title": "‚ùå Agent Orchestrator - Erro",
                
                # Email statistics
                "unread_emails": "E-mails n√£o lidos",
                "recent_emails": "Recentes (3h)",
                "no_emails": "Nenhum e-mail n√£o lido encontrado.",
                
                # Calendar statistics
                "meetings_today": "Reuni√µes hoje",
                "virtual_meetings": "Virtuais",
                "total_duration": "Dura√ß√£o total",
                "no_meetings": "Nenhuma reuni√£o agendada para hoje.",
                
                # Time and date
                "generated_at": "Gerado √†s",
                "on_date": "em",
                "hours": "h",
                "minutes": "min",
                
                # System status
                "available": "Dispon√≠vel",
                "unavailable": "Indispon√≠vel",
                "connected": "Conectado", 
                "disconnected": "Desconectado",
                "accessible": "Acess√≠vel",
                "not_accessible": "N√£o Acess√≠vel",
                "authenticated": "Autenticado",
                "not_authenticated": "N√£o Autenticado",
                
                # Notifications
                "scheduled_run_started": "Execu√ß√£o Agendada",
                "scheduled_run_started_msg": "Iniciando gera√ß√£o autom√°tica do resumo di√°rio...",
                "scheduled_run_completed": "Resumo Conclu√≠do",
                "scheduled_run_completed_msg": "Gera√ß√£o autom√°tica do resumo di√°rio foi conclu√≠da com sucesso!",
                "test_connection": "Agent Orchestrator - Teste de conex√£o",
                
                # Errors and warnings
                "warnings": "Avisos",
                "errors": "Erros", 
                "connection_test": "Verifica√ß√£o",
                
                # Days of week
                "monday": "Segunda-feira",
                "tuesday": "Ter√ßa-feira",
                "wednesday": "Quarta-feira", 
                "thursday": "Quinta-feira",
                "friday": "Sexta-feira",
                "saturday": "S√°bado",
                "sunday": "Domingo"
            },
            
            "en": {
                # Headers and titles
                "daily_summary_title": "ü§ñ Daily Summary - Agent Orchestrator",
                "email_summary_title": "üìß Email Summary",
                "calendar_summary_title": "üìÖ Calendar Summary",
                "unified_summary_title": "üìã Daily Briefing",
                "system_status_title": "üîç System Status",
                "error_notification_title": "‚ùå Agent Orchestrator - Error",
                
                # Email statistics
                "unread_emails": "Unread emails",
                "recent_emails": "Recent (3h)",
                "no_emails": "No unread emails found.",
                
                # Calendar statistics
                "meetings_today": "Meetings today",
                "virtual_meetings": "Virtual",
                "total_duration": "Total duration", 
                "no_meetings": "No meetings scheduled for today.",
                
                # Time and date
                "generated_at": "Generated at",
                "on_date": "on",
                "hours": "h",
                "minutes": "m",
                
                # System status
                "available": "Available",
                "unavailable": "Unavailable",
                "connected": "Connected",
                "disconnected": "Disconnected", 
                "accessible": "Accessible",
                "not_accessible": "Not Accessible",
                "authenticated": "Authenticated",
                "not_authenticated": "Not Authenticated",
                
                # Notifications
                "scheduled_run_started": "Scheduled Execution",
                "scheduled_run_started_msg": "Starting automatic daily summary generation...",
                "scheduled_run_completed": "Summary Completed",
                "scheduled_run_completed_msg": "Automatic daily summary generation completed successfully!",
                "test_connection": "Agent Orchestrator - Connection test",
                
                # Errors and warnings
                "warnings": "Warnings",
                "errors": "Errors",
                "connection_test": "Check",
                
                # Days of week
                "monday": "Monday",
                "tuesday": "Tuesday",
                "wednesday": "Wednesday",
                "thursday": "Thursday", 
                "friday": "Friday",
                "saturday": "Saturday",
                "sunday": "Sunday"
            },
            
            "es": {
                # Headers and titles
                "daily_summary_title": "ü§ñ Resumen Diario - Agent Orchestrator",
                "email_summary_title": "üìß Resumen de Correos",
                "calendar_summary_title": "üìÖ Resumen del Calendario",
                "unified_summary_title": "üìã Resumen del D√≠a",
                "system_status_title": "üîç Estado del Sistema",
                "error_notification_title": "‚ùå Agent Orchestrator - Error",
                
                # Email statistics
                "unread_emails": "Correos no le√≠dos",
                "recent_emails": "Recientes (3h)",
                "no_emails": "No se encontraron correos no le√≠dos.",
                
                # Calendar statistics
                "meetings_today": "Reuniones hoy",
                "virtual_meetings": "Virtuales",
                "total_duration": "Duraci√≥n total",
                "no_meetings": "No hay reuniones programadas para hoy.",
                
                # Time and date
                "generated_at": "Generado a las",
                "on_date": "el",
                "hours": "h",
                "minutes": "m",
                
                # System status
                "available": "Disponible",
                "unavailable": "No Disponible",
                "connected": "Conectado",
                "disconnected": "Desconectado",
                "accessible": "Accesible", 
                "not_accessible": "No Accesible",
                "authenticated": "Autenticado",
                "not_authenticated": "No Autenticado",
                
                # Notifications
                "scheduled_run_started": "Ejecuci√≥n Programada",
                "scheduled_run_started_msg": "Iniciando generaci√≥n autom√°tica del resumen diario...",
                "scheduled_run_completed": "Resumen Completado", 
                "scheduled_run_completed_msg": "¬°Generaci√≥n autom√°tica del resumen diario completada con √©xito!",
                "test_connection": "Agent Orchestrator - Prueba de conexi√≥n",
                
                # Errors and warnings
                "warnings": "Advertencias",
                "errors": "Errores",
                "connection_test": "Verificaci√≥n",
                
                # Days of week
                "monday": "Lunes",
                "tuesday": "Martes",
                "wednesday": "Mi√©rcoles",
                "thursday": "Jueves",
                "friday": "Viernes",
                "saturday": "S√°bado",
                "sunday": "Domingo"
            }
        }
    
    def get(self, key: str, **kwargs) -> str:
        """Get translated string with optional formatting"""
        try:
            translation = self.translations[self.language].get(key, key)
            
            # Apply formatting if kwargs provided
            if kwargs:
                translation = translation.format(**kwargs)
                
            return translation
        except Exception as e:
            self.logger.warning(f"Translation error for key '{key}': {e}")
            return key
    
    def format_date(self, date_obj, date_format: str = None) -> str:
        """Format date according to language settings"""
        if not date_format:
            # Use default format from translations or fallback
            date_format = "%d/%m/%Y" if self.language.startswith("pt") else "%Y-%m-%d"
        
        try:
            return date_obj.strftime(date_format)
        except Exception as e:
            self.logger.warning(f"Date formatting error: {e}")
            return str(date_obj)
    
    def format_time(self, time_obj, time_format: str = None) -> str:
        """Format time according to language settings"""
        if not time_format:
            time_format = "%H:%M"
        
        try:
            return time_obj.strftime(time_format)
        except Exception as e:
            self.logger.warning(f"Time formatting error: {e}")
            return str(time_obj)
    
    def get_available_languages(self) -> list:
        """Get list of available languages"""
        return list(self.translations.keys())
    
    def set_language(self, language: str):
        """Change current language"""
        if language.lower() in self.translations:
            self.language = language.lower()
            self.logger.info(f"Language changed to: {self.language}")
        else:
            self.logger.warning(f"Language '{language}' not supported")
    
    def get_current_language(self) -> str:
        """Get current language"""
        return self.language